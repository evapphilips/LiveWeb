<html>

<head>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">

        // connect to socket server
        var socket = io.connect();
        socket.on('connect', function () {
            console.log("Connected");
        });

        // make scale function
        const scale = (num, in_min, in_max, out_min, out_max) => {
            return (num - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
        }

        // set position variables
        var posX;
        var posY;
        var name;

        // when page loads call init funciton 
        window.addEventListener('load', init);
        function init() {
            // access canvas
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            // resize canvas to fill the screen
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // set inital position
            posX = 0;
            posY = 0;
            name = "";
            

            // put a users drawing on the screen
            function userDraw() {
                context.translate(canvas.width/2, canvas.height/2);
                // draw background
                context.fillStyle = "#000"
                context.fillRect(-canvas.width/2, -canvas.height/2, canvas.width, canvas.height);
                // draw point for user
                context.fillStyle = "#FFF";
                context.fillRect(posX, posY, 5, 5);

                // // transparent box
                // context.globalAlpha = 0.2;
                // context.fillStyle = "#000";
                // context.fillRect(-canvas.width/2, -canvas.height/2, canvas.width, canvas.height); 
                // context.globalAlpha = 1.0;

                // write name
                context.fillStyle = "#FFF";
                context.font = "12px Arial";
                context.fillStyle = "white";
                context.fillText(name, posX+ 10, posY);

                context.translate(-canvas.width/2, -canvas.height/2);
            }


            // when a position value from a user is recieved
            socket.on('posData', (data) => {
                // scale alpha
                if(data.a<360 && data.a>300){
                    posX = scale(data.a, 360, 300, 0, canvas.width/2);
                }else if(data.a>0 && data.a<60){
                    posX = scale(data.a, 0, 60, 0, -canvas.width/2);
                }
                // scale beta
                if(data.b>0 && data.b<60){
                    posY = scale(data.b, 0, 60, canvas.height/2, -canvas.height/2)
                }

                // set username
                name = data.name
                //console.log(name);

                // draw point to screen
                userDraw();
            })
        }

    </script>
</head>

<body style="margin: 0%;">
    <canvas id="canvas" width="800px" height="600px" style="background-color: black;"></canvas>

</body>

</html>